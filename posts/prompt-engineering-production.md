# Prompt Engineering：从入门到生产级

> 在大模型应用中，Prompt 的质量直接决定了产品体验的上限。

## Prompt 不只是"写句话"

很多人对 Prompt Engineering 的理解停留在"给 AI 写指令"的层面，但在生产环境中，一个好的 Prompt 需要考虑：

- **稳定性**：同样的输入，输出格式是否一致？
- **鲁棒性**：面对边界情况，是否能优雅处理？
- **可维护性**：团队其他成员能否理解和迭代？
- **可评测性**：如何量化 Prompt 的效果？

## 核心方法论

### 1. 角色设定（System Prompt）

给模型一个清晰的角色定义，比"你是一个AI助手"有效10倍：

```
你是一位拥有20年经验的企业信贷分析师。
你精通：企业财务报表分析、现金流异常检测、关联交易识别。
你的分析风格：严谨、数据驱动、结论明确。
```

### 2. CoT 思维链

对于复杂推理任务，引导模型"展示工作过程"：

```
请按以下步骤分析这笔交易：
1. 首先确认交易双方的关系
2. 然后判断交易金额是否异常
3. 接着分析交易频率和时间模式
4. 最后给出风险评级和依据
```

### 3. Few-shot 示例

3-5 个精选示例胜过 1000 字的描述：

```
## 示例1
输入：XX公司 转出 300万 至 YY公司，备注：货款
分析：正常主营业务付款，金额与该公司月均采购额相符
评级：低风险

## 示例2
输入：XX公司 转出 500万 至个人账户 张三，备注：咨询费
分析：大额转个人且备注模糊，疑似资金套现
评级：高风险
```

### 4. 结构化输出

在生产环境中，非结构化输出是灾难：

```
请严格按照以下JSON格式输出，不要添加任何其他内容：
{
  "risk_level": "high|medium|low",
  "risk_score": 0-100,
  "findings": ["发现1", "发现2"],
  "evidence": ["证据1", "证据2"],
  "recommendation": "建议内容"
}
```

## 生产级优化策略

### 温度控制

- **分类/提取任务** → `temperature: 0`，追求确定性
- **报告生成任务** → `temperature: 0.3`，略带创意但可控
- **创意内容** → `temperature: 0.7+`，鼓励多样性

### Prompt 版本管理

我们用类似代码版本管理的方式管理 Prompt：

```
prompts/
├── v1.0_classify.txt    # 初始版本
├── v1.1_classify.txt    # 增加2个示例
├── v1.2_classify.txt    # 优化边界处理
└── v2.0_classify.txt    # 架构重构
```

每次迭代都跑一遍评测集，确保改进有据可依。

### 防御性编程

```
## 重要约束
- 如果无法确定分类，输出 "uncertain" 而不是猜测
- 如果输入不是有效的交易记录，返回错误提示
- 输出中不要包含任何分析过程的解释
- 永远不要编造不存在的数据
```

## 评测体系

建立评测数据集是 Prompt Engineering 最重要的基础设施：

| 维度 | 指标 | 目标 |
|------|------|------|
| 准确率 | 分类正确率 | >95% |
| 一致性 | 相同输入输出一致 | >99% |
| 格式合规 | JSON解析成功率 | 100% |
| 延迟 | P99延迟 | <3s |

## 写在最后

Prompt Engineering 是一项需要**产品思维**和**工程素养**兼备的技能。好的 Prompt 工程师，本质上是在用自然语言"编程"——而编程的核心原则（模块化、可测试、可维护）同样适用。
